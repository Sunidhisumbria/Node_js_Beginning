"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.updateEditUser=exports.deleteUser=exports.profile=exports.login=exports.register=void 0;var _user=require("../models/user.js"),_bcrypt=require("bcrypt"),_jsonwebtoken=_interopRequireDefault(require("jsonwebtoken"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var register=function(r,s){var t,n,a,u,o,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.body,n=t.name,a=t.email,u=t.phone,o=t.password,a&&u&&o&&n){e.next=3;break}return e.abrupt("return",s.status(400).json({success:!1,message:"ALL field are required "}));case 3:return e.next=5,regeneratorRuntime.awrap((0,_bcrypt.hash)(o,10));case 5:return c=e.sent,e.next=8,regeneratorRuntime.awrap(_user.User.create({name:n,email:a,password:c,phone:u}));case 8:s.status(201).json({success:!0,message:"User created successfully"});case 9:case"end":return e.stop()}})};exports.register=register;var login=function(r,s){var t,n,a,u,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.body,n=t.email,a=t.password,e.next=3,regeneratorRuntime.awrap(_user.User.findOne({email:n}).select("+password"));case 3:if(u=e.sent){e.next=6;break}return e.abrupt("return",s.status(400).json({success:!1,message:"Invalid email or Password"}));case 6:return e.next=8,regeneratorRuntime.awrap((0,_bcrypt.compare)(a,u.password));case 8:if(e.sent){e.next=11;break}return e.abrupt("return",s.status(400).json({success:!1,message:"Invalid email or Password"}));case 11:return o=_jsonwebtoken.default.sign({userId:u._id},"your-secret-key",{expiresIn:"1h"}),e.abrupt("return",s.status(200).cookie("test-token",o,{maxAge:864e5,httpOnly:!0}).json({success:!0,message:"User loggedIn Successfully",user:u,token:o}));case 13:case"end":return e.stop()}})};exports.login=login;var profile=function(r,s){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(_user.User.findById(r.user));case 2:return t=e.sent,e.abrupt("return",s.status(200).json({success:!1,message:"Get Profile Successfully",user:t}));case 4:case"end":return e.stop()}})};exports.profile=profile;var deleteUser=function(r,s){var t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.params.id,e.next=3,regeneratorRuntime.awrap(_user.User.findByIdAndDelete(t));case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return",s.status(404).json({message:"User not found"}));case 6:s.status(200).json({message:"User deleted successfully",user:n});case 7:case"end":return e.stop()}})};exports.deleteUser=deleteUser;var updateEditUser=function(r,s){var t,n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.params.id,n=r.body,e.next=4,regeneratorRuntime.awrap(_user.User.findById(t));case 4:return a=e.sent,n.name&&(a.name=n.name),n.email&&(a.email=n.email),n.phone&&(a.phone=n.phone),e.next=10,regeneratorRuntime.awrap(a.save());case 10:s.status(201).json({success:!0,message:"User Updated successfully",user:a});case 11:case"end":return e.stop()}})};exports.updateEditUser=updateEditUser;
//# sourceMappingURL=user.min.js.map

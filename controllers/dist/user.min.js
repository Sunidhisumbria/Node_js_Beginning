"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.uploadSingleFile=exports.logout=exports.updateEditUser=exports.deleteUser=exports.profile=exports.login=exports.register=void 0;var _user=require("../models/user.js"),_bcrypt=require("bcrypt"),_jsonwebtoken=_interopRequireDefault(require("jsonwebtoken")),_cloudinary=require("cloudinary");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}!function(){var r,s,t;regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return _cloudinary.v2.config({cloud_name:"dqr2mxlv3",api_key:"847423956334364",api_secret:"ueGE5KG28uAXIpw-JSVnE6P8omM"}),e.next=3,regeneratorRuntime.awrap(_cloudinary.v2.uploader.upload("https://res.cloudinary.com/demo/image/upload/getting-started/shoes.jpg",{public_id:"shoes"}).catch(function(e){console.log(e)}));case 3:r=e.sent,console.log(r),s=_cloudinary.v2.url("shoes",{fetch_format:"auto",quality:"auto"}),console.log(s),t=_cloudinary.v2.url("shoes",{crop:"auto",gravity:"auto",width:500,height:500}),console.log(t);case 9:case"end":return e.stop()}})}();var register=function(r,s){var t,n,a,o,u,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.body,n=t.name,a=t.email,o=t.phone,u=t.password,a&&o&&u&&n){e.next=3;break}return e.abrupt("return",s.status(400).json({success:!1,message:"ALL field are required "}));case 3:return e.next=5,regeneratorRuntime.awrap((0,_bcrypt.hash)(u,10));case 5:return i=e.sent,e.next=8,regeneratorRuntime.awrap(_user.User.create({name:n,email:a,password:i,phone:o}));case 8:s.status(201).json({success:!0,message:"User created successfully"});case 9:case"end":return e.stop()}})};exports.register=register;var login=function(r,s){var t,n,a,o,u;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.body,n=t.email,a=t.password,e.next=3,regeneratorRuntime.awrap(_user.User.findOne({email:n}).select("+password"));case 3:if(o=e.sent){e.next=6;break}return e.abrupt("return",s.status(400).json({success:!1,message:"Invalid email or Password"}));case 6:return e.next=8,regeneratorRuntime.awrap((0,_bcrypt.compare)(a,o.password));case 8:if(e.sent){e.next=11;break}return e.abrupt("return",s.status(400).json({success:!1,message:"Invalid email or Password"}));case 11:return u=_jsonwebtoken.default.sign({userId:o._id},"your-secret-key",{expiresIn:"1h"}),e.abrupt("return",s.status(200).cookie("test-token",u,{maxAge:864e5,httpOnly:!0}).json({success:!0,message:"User loggedIn Successfully",user:o,token:u}));case 13:case"end":return e.stop()}})};exports.login=login;var profile=function(r,s){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(r),e.next=3,regeneratorRuntime.awrap(_user.User.findById(r.user));case 3:return t=e.sent,e.abrupt("return",s.status(200).json({success:!1,message:"Get Profile Successfully",user:t}));case 5:case"end":return e.stop()}})};exports.profile=profile;var deleteUser=function(r,s){var t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.params.id,e.next=3,regeneratorRuntime.awrap(_user.User.findByIdAndDelete(t));case 3:if(n=e.sent){e.next=6;break}return e.abrupt("return",s.status(404).json({message:"User not found"}));case 6:s.status(200).json({message:"User deleted successfully",user:n});case 7:case"end":return e.stop()}})};exports.deleteUser=deleteUser;var updateEditUser=function(r,s){var t,n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.params.id,n=r.body,e.next=4,regeneratorRuntime.awrap(_user.User.findById(t));case 4:return a=e.sent,n.name&&(a.name=n.name),n.email&&(a.email=n.email),n.phone&&(a.phone=n.phone),e.next=10,regeneratorRuntime.awrap(a.save());case 10:s.status(201).json({success:!0,message:"User Updated successfully",user:a});case 11:case"end":return e.stop()}})};exports.updateEditUser=updateEditUser;var logout=function(e,r){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(r.clearCookie("test-token"));case 2:return e.abrupt("return",r.status(200).json({success:!0,message:"User Logout Successfull"}));case 3:case"end":return e.stop()}})};exports.logout=logout;var uploadSingleFile=function(r,s){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(r.file,"=========="),e.prev=1,r.file){e.next=4;break}return e.abrupt("return",s.status(400).send("No file uploaded"));case 4:return t=new _user.File({originalName:r.file.originalname,fileName:r.file.filename,filePath:r.file.path,size:r.file.size,mimeType:r.file.mimetype}),e.next=7,regeneratorRuntime.awrap(t.save());case 7:s.status(201).send({message:"File uploaded successfully",file:t}),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("Error uploading file:",e.t0),s.status(500).send("An error occurred while uploading the file");case 14:case"end":return e.stop()}},null,null,[[1,10]])};exports.uploadSingleFile=uploadSingleFile;
//# sourceMappingURL=user.min.js.map
